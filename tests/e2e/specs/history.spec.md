# E2Eテストシナリオ: 履歴確認 (UC-010)

## 概要
保存済みシミュレーションの履歴確認、詳細表示、削除に関するE2Eテストシナリオ

---

## シナリオ1: マイページでのシミュレーション一覧表示

### 前提条件
- ユーザーはログイン済み
- 保存済みシミュレーションが複数ある

### テストステップ（Given/When/Then）

**Given（前提）:**
- ユーザーがログインしている
- 過去に3件のシミュレーションを保存している

**When（操作）:**
1. マイページ（/mypage）にアクセスする

**Then（期待結果）:**
- ユーザーのメールアドレスが表示される
- 「保存済みシミュレーション（3件）」と件数が表示される
- シミュレーションのサムネイル（50%の変化度合い画像）がグリッド表示される
- 各サムネイルに作成日時が表示される
- 各サムネイルに「共有」ボタンと「削除」ボタンが表示される
- 新しいシミュレーションが上位に表示される（作成日降順）

---

## シナリオ2: シミュレーション詳細表示

### 前提条件
- マイページが表示されている
- 保存済みシミュレーションがある

### テストステップ（Given/When/Then）

**Given（前提）:**
- マイページにシミュレーション一覧が表示されている

**When（操作）:**
1. サムネイル画像をクリックする

**Then（期待結果）:**
- シミュレーション結果画面（/simulate/result）に遷移する
- 選択したシミュレーションの詳細が表示される
- スライダーで変化度合いを確認できる
- 「保存」ボタンは「保存済み」状態または非表示
- 「共有URL」ボタンが表示される

---

## シナリオ3: シミュレーション一覧のページング

### 前提条件
- ユーザーはログイン済み
- 保存済みシミュレーションが21件以上ある（デフォルト20件表示）

### テストステップ（Given/When/Then）

**Given（前提）:**
- マイページが表示されている
- 最初の20件が表示されている

**When（操作）:**
1. 「さらに読み込む」ボタンをクリックする

**Then（期待結果）:**
- 追加のシミュレーションが読み込まれる
- 表示件数が増加する
- 読み込み中はローディング表示が表示される
- 全件読み込み完了後は「さらに読み込む」ボタンが非表示になる

---

## シナリオ4: シミュレーションの削除

### 前提条件
- マイページが表示されている
- 保存済みシミュレーションがある

### テストステップ（Given/When/Then）

**Given（前提）:**
- マイページにシミュレーション一覧が表示されている

**When（操作）:**
1. シミュレーションカードの「削除」ボタンをクリックする

**Then（期待結果）:**
- 削除確認モーダルが表示される
- 「このシミュレーションを削除しますか？」というメッセージが表示される
- 「この操作は取り消せません。」という警告が表示される
- 「キャンセル」ボタンと「削除」ボタンが表示される

---

## シナリオ5: 削除確認後の実行

### 前提条件
- 削除確認モーダルが表示されている

### テストステップ（Given/When/Then）

**Given（前提）:**
- 削除確認モーダルが表示されている

**When（操作）:**
1. 「削除」ボタンをクリックする

**Then（期待結果）:**
- シミュレーションが削除される
- モーダルが閉じる
- 一覧から該当のシミュレーションが消える
- 「シミュレーションを削除しました」というメッセージが表示される
- 件数表示が更新される

---

## シナリオ6: 削除のキャンセル

### 前提条件
- 削除確認モーダルが表示されている

### テストステップ（Given/When/Then）

**Given（前提）:**
- 削除確認モーダルが表示されている

**When（操作）:**
1. 「キャンセル」ボタンをクリックする

**Then（期待結果）:**
- モーダルが閉じる
- シミュレーションは削除されない
- 一覧はそのまま

---

## シナリオ7: 保存済みシミュレーションがない場合

### 前提条件
- ユーザーはログイン済み
- シミュレーションを1件も保存していない

### テストステップ（Given/When/Then）

**Given（前提）:**
- 新規ユーザーでシミュレーション保存履歴がない

**When（操作）:**
1. マイページ（/mypage）にアクセスする

**Then（期待結果）:**
- 「保存済みシミュレーション（0件）」と表示される、または
- 「まだシミュレーションがありません」というメッセージが表示される
- 「今すぐシミュレーションを作成」のようなCTAリンクが表示される

---

## シナリオ8: 新規シミュレーション作成への導線

### 前提条件
- マイページが表示されている

### テストステップ（Given/When/Then）

**Given（前提）:**
- マイページが表示されている

**When（操作）:**
1. ヘッダーまたはページ内の「新規作成」ボタンをクリックする

**Then（期待結果）:**
- シミュレーション作成画面（/simulate）に遷移する

---

## エラーケース

### E1: シミュレーション取得エラー

**Given（前提）:**
- ユーザーはログイン済み

**When（操作）:**
1. マイページにアクセスする
2. サーバーがエラーを返す

**Then（期待結果）:**
- エラーメッセージ「シミュレーションの取得に失敗しました」が表示される
- 「再読み込み」ボタンが表示される

---

### E2: 削除時のエラー

**Given（前提）:**
- 削除確認モーダルが表示されている

**When（操作）:**
1. 「削除」ボタンをクリックする
2. サーバーがエラーを返す

**Then（期待結果）:**
- エラーメッセージ「削除に失敗しました。再度お試しください」が表示される
- シミュレーションは一覧に残っている

---

### E3: 他ユーザーのシミュレーションにアクセス試行

**Given（前提）:**
- ユーザーAがログイン済み
- ユーザーBのシミュレーションIDを知っている

**When（操作）:**
1. ユーザーBのシミュレーション詳細URL（/simulations/{B's_id}）に直接アクセスする

**Then（期待結果）:**
- 「アクセスが拒否されました」または「シミュレーションが見つかりません」エラーが表示される
- 他ユーザーのデータは表示されない

---

### E4: サムネイル画像の読み込みエラー

**Given（前提）:**
- マイページにシミュレーション一覧が表示されている
- 一部の画像のCDNが応答しない

**When（操作）:**
1. マイページを表示する

**Then（期待結果）:**
- 読み込みに失敗した画像はプレースホルダーまたはエラー画像が表示される
- 他のシミュレーションは正常に表示される
- ページ全体がクラッシュしない

---

## テストデータ

| データ | 説明 |
|--------|------|
| user_with_3_sims | 3件のシミュレーションを保存しているユーザー |
| user_with_25_sims | 25件のシミュレーションを保存しているユーザー（ページング確認用） |
| user_with_no_sims | シミュレーション未保存のユーザー |

## 関連ユースケース
- UC-010: 保存済みシミュレーションの履歴確認

## 関連画面
- SCR-006: マイページ
- SCR-003: シミュレーション結果画面

## API参照
- GET /api/v1/simulations - シミュレーション一覧取得
- GET /api/v1/simulations/{id} - シミュレーション詳細取得
- DELETE /api/v1/simulations/{id} - シミュレーション削除
