# E2Eテストシナリオ: 画像アップロード (UC-002, UC-003)

## 概要
現在の顔画像・理想の顔画像のアップロードに関するE2Eテストシナリオ

---

## シナリオ1: 現在の顔画像の正常アップロード

### 前提条件
- 利用規約に同意済み
- シミュレーション作成画面（/simulate）にアクセス済み

### テストステップ（Given/When/Then）

**Given（前提）:**
- ユーザーがシミュレーション作成画面を開いている
- 「現在の顔」アップロードエリアが表示されている

**When（操作）:**
1. 「現在の顔」のアップロードエリアをクリックする
2. ファイル選択ダイアログで有効なJPEG画像（顔が1つ、10MB以下）を選択する

**Then（期待結果）:**
- 画像がアップロードされる
- 顔検出処理が実行される（ローディング表示）
- プレビュー画像が表示される
- 「削除」ボタンが表示される
- 「理想の顔」アップロードエリアが強調表示される

---

## シナリオ2: 理想の顔画像の正常アップロード

### 前提条件
- 利用規約に同意済み
- 現在の顔画像がアップロード済み

### テストステップ（Given/When/Then）

**Given（前提）:**
- 現在の顔画像がアップロードされている
- 「理想の顔」アップロードエリアが表示されている

**When（操作）:**
1. 「理想の顔」のアップロードエリアをクリックする
2. ファイル選択ダイアログで有効なPNG画像（顔が1つ、10MB以下）を選択する

**Then（期待結果）:**
- 画像がアップロードされる
- 顔検出処理が実行される（ローディング表示）
- プレビュー画像が表示される
- 「シミュレーションを生成」ボタンが活性化される

---

## シナリオ3: ドラッグ&ドロップでのアップロード

### 前提条件
- 利用規約に同意済み

### テストステップ（Given/When/Then）

**Given（前提）:**
- ユーザーがシミュレーション作成画面を開いている
- 有効な画像ファイルを用意している

**When（操作）:**
1. 画像ファイルを「現在の顔」アップロードエリアにドラッグする
2. ドロップする

**Then（期待結果）:**
- ドロップ領域がハイライト表示される（ドラッグ中）
- 画像がアップロードされる
- プレビュー画像が表示される

---

## シナリオ4: アップロード済み画像の削除

### 前提条件
- 現在の顔画像がアップロード済み

### テストステップ（Given/When/Then）

**Given（前提）:**
- 現在の顔画像がアップロードされプレビューが表示されている

**When（操作）:**
1. 「削除」ボタン（×ボタン）をクリックする

**Then（期待結果）:**
- プレビュー画像が消える
- アップロードエリアが初期状態（「画像を選択」または「ドロップ」）に戻る
- 両方の画像がアップロード済みだった場合、「シミュレーションを生成」ボタンが非活性化される

---

## シナリオ5: 両方の画像アップロード完了

### 前提条件
- 利用規約に同意済み

### テストステップ（Given/When/Then）

**Given（前提）:**
- ユーザーがシミュレーション作成画面を開いている

**When（操作）:**
1. 「現在の顔」に有効な画像をアップロードする
2. 「理想の顔」に有効な画像をアップロードする

**Then（期待結果）:**
- 両方のプレビュー画像が表示される
- 「シミュレーションを生成」ボタンが活性化される
- ボタンをクリック可能な状態になる

---

## エラーケース

### E1: 不正な画像形式（GIF）

**Given（前提）:**
- ユーザーがシミュレーション作成画面を開いている

**When（操作）:**
1. GIF形式の画像ファイルをアップロードしようとする

**Then（期待結果）:**
- エラーメッセージ「JPEG、PNG形式の画像をアップロードしてください」が表示される
- 画像はアップロードされない
- アップロードエリアは初期状態のまま

---

### E2: 不正な画像形式（WebP）

**Given（前提）:**
- ユーザーがシミュレーション作成画面を開いている

**When（操作）:**
1. WebP形式の画像ファイルをアップロードしようとする

**Then（期待結果）:**
- エラーメッセージ「JPEG、PNG形式の画像をアップロードしてください」が表示される
- 画像はアップロードされない

---

### E3: ファイルサイズ超過

**Given（前提）:**
- ユーザーがシミュレーション作成画面を開いている

**When（操作）:**
1. 15MBのJPEG画像ファイルをアップロードしようとする

**Then（期待結果）:**
- エラーメッセージ「画像サイズは10MB以下にしてください」が表示される
- 画像はアップロードされない

---

### E4: 顔が検出されない

**Given（前提）:**
- ユーザーがシミュレーション作成画面を開いている

**When（操作）:**
1. 顔が写っていない画像（風景写真など）をアップロードする

**Then（期待結果）:**
- エラーメッセージ「顔を検出できませんでした。正面を向いた明るい写真をお使いください」が表示される
- 画像はアップロードされない（またはプレビュー後に拒否）

---

### E5: 複数の顔が検出される

**Given（前提）:**
- ユーザーがシミュレーション作成画面を開いている

**When（操作）:**
1. 2人以上の顔が写った集合写真をアップロードする

**Then（期待結果）:**
- エラーメッセージ「複数の顔が検出されました。1人のみ写った写真をお使いください」が表示される
- 画像はアップロードされない

---

### E6: ファイル以外がドロップされた場合

**Given（前提）:**
- ユーザーがシミュレーション作成画面を開いている

**When（操作）:**
1. テキストファイル（.txt）をドロップする

**Then（期待結果）:**
- エラーメッセージ「JPEG、PNG形式の画像をアップロードしてください」が表示される
- 何もアップロードされない

---

### E7: 横向きの顔画像

**Given（前提）:**
- ユーザーがシミュレーション作成画面を開いている

**When（操作）:**
1. 横を向いた顔写真をアップロードする

**Then（期待結果）:**
- 顔検出に失敗する可能性がある
- 失敗した場合、ガイダンス「正面を向いた明るい写真をお使いください」が表示される

---

## テストデータ

| ファイル名 | 説明 | 期待結果 |
|------------|------|----------|
| valid_face.jpg | 正面顔、JPEG、5MB | 成功 |
| valid_face.png | 正面顔、PNG、3MB | 成功 |
| landscape.jpg | 風景写真 | 顔未検出エラー |
| group_photo.jpg | 集合写真（3人） | 複数顔エラー |
| large_file.jpg | 15MB画像 | サイズ超過エラー |
| animated.gif | GIF画像 | 形式エラー |
| image.webp | WebP画像 | 形式エラー |
| side_face.jpg | 横向き顔 | 顔未検出の可能性 |

## 関連ユースケース
- UC-002: 現在の顔画像をアップロード
- UC-003: 理想の顔画像をアップロード

## 関連画面
- SCR-002: シミュレーション作成画面

## バリデーションルール参照
- BR-IMG-001: JPEG、PNG形式のみ
- BR-IMG-002: 10MB以下
- BR-IMG-004: 顔検出必須
- BR-IMG-005: 単一顔のみ
